# 新闻联播投资分析系统 - 预抓取模式使用指南

## 🎯 **系统概述**

本系统已升级为**预抓取模式**，所有新闻和分析数据事先准备，用户无需等待实时抓取和AI分析。

## 🚀 **核心特性**

### ✅ **预抓取优势**
- **即时响应**：所有数据已预先准备，选择日期即可查看
- **一致性强**：统一的数据源和分析标准
- **用户友好**：无需等待抓取和AI分析过程
- **成本优化**：避免重复的API调用

### 📊 **数据覆盖**
- **时间范围**：最近30天的新闻联播数据
- **数据完整性**：新闻内容 + AI投资分析
- **更新频率**：可通过数据管理页面手动更新

## 🎮 **用户使用流程**

### **1. 查看分析结果**
```
选择日期 → 自动加载数据 → 查看投资分析
```

### **2. 浏览历史数据**
```
主页 → 月度总览 → 查看30天汇总统计
```

### **3. 管理数据**
```
主页 → 数据管理 → 查看统计 → 批量更新
```

## 🛠️ **管理员操作**

### **数据管理页面** (`/admin`)
- 📊 **数据统计**：查看30天数据覆盖情况
- 🔄 **批量更新**：一键更新所有数据
- 📅 **详细状态**：每日数据完整性检查

### **命令行操作**
```bash
# 批量预抓取最近30天数据
npm run batch-scrape

# 启动开发服务器
npm run dev

# 访问页面
http://localhost:3000      # 主页
http://localhost:3000/admin    # 数据管理
http://localhost:3000/monthly  # 月度总览
```

## 📋 **页面功能说明**

### **主页** (`/`)
- ✅ 日期选择器：选择要查看的日期
- ✅ 智能显示：根据数据状态显示不同内容
- ✅ AI分析按钮：对有新闻但无分析的日期进行分析
- ✅ 导航链接：快速访问其他页面

### **月度总览** (`/monthly`)
- ✅ 统计概览：30天数据汇总
- ✅ 排行榜：热门行业、公司、期货等
- ✅ 每日详情：可展开查看具体内容

### **数据管理** (`/admin`)
- ✅ 数据统计：实时数据状态监控
- ✅ 批量操作：一键更新所有数据
- ✅ 详细列表：每日数据完整性检查

## 🔧 **技术架构**

### **预抓取脚本** (`scripts/batch-scrape.ts`)
```typescript
// 主要功能
- 抓取最近30天新闻
- 自动AI分析
- 批量保存结果
- 进度日志输出
```

### **数据管理API** (`/api/data-management`)
```typescript
// GET: 获取数据统计
// POST: 触发批量预抓取
```

### **存储系统**
- 📁 **本地文件**：开发环境使用项目下 `data/` 目录
- ☁️ **Vercel KV**：生产环境可切换到云存储
- 🔄 **自动适配**：通过 `storage-adapter.ts` 统一接口

## 🎯 **最佳实践**

### **日常使用**
1. **查看分析**：直接选择日期查看结果
2. **浏览趋势**：使用月度总览了解市场趋势
3. **数据更新**：定期通过管理页面更新数据

### **数据管理**
1. **定期更新**：建议每周执行一次批量预抓取
2. **状态监控**：通过管理页面检查数据完整性
3. **日志查看**：关注控制台输出了解处理进度

### **性能优化**
1. **缓存利用**：充分利用预抓取的缓存优势
2. **按需分析**：只对缺失分析的日期执行AI分析
3. **批量处理**：使用批量脚本而非逐日处理

## 🚨 **注意事项**

### **数据源依赖**
- 依赖 `cn.govopendata.com` 的数据可用性
- 网络连接问题可能影响批量抓取
- 建议在网络稳定时执行批量操作

### **AI分析限制**
- 受千问API配额限制
- 批量分析时注意请求频率
- 失败的分析可以单独重试

### **存储空间**
- 本地文件存储需要足够磁盘空间
- 30天数据约占用几MB空间
- 定期清理过期数据

## 🎊 **升级优势总结**

| 特性 | 原版本 | 预抓取版本 |
|------|--------|------------|
| 响应速度 | 需等待抓取+分析 | 即时响应 |
| 用户体验 | 需要手动操作 | 自动化处理 |
| 数据一致性 | 可能不一致 | 统一标准 |
| 成本控制 | 重复API调用 | 一次性处理 |
| 管理便利性 | 分散操作 | 集中管理 |

现在你的系统已经完全升级为预抓取模式，提供更好的用户体验和更高的效率！🚀
